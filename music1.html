<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Music Player Simulation</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c3aed; --muted:#9aa4b2; --glass:rgba(255,255,255,0.03);
      --radius:14px; --pad:16px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071022 0%, #071a2b 100%);color:#e6eef6}

    .app{max-width:980px;margin:40px auto;padding:24px;border-radius:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(2,6,23,0.6);display:grid;grid-template-columns:1fr 360px;gap:20px}

    .player{background:var(--card);border-radius:var(--radius);padding:18px;display:flex;flex-direction:column;gap:12px}
    .meta{display:flex;gap:14px;align-items:center}
    .cover{width:112px;height:112px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#0ea5a0);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px}
    .track-info{flex:1}
    .title{font-size:20px;font-weight:600}
    .artist{color:var(--muted);font-size:13px;margin-top:4px}

    .controls{display:flex;align-items:center;gap:12px;justify-content:center;padding:8px}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;min-width:44px}
    .btn.big{min-width:64px;height:64px;border-radius:16px}

    .progress{display:flex;align-items:center;gap:12px}
    .time{width:46px;text-align:center;color:var(--muted);font-size:13px}
    .progress-bar{flex:1;height:8px;background:rgba(255,255,255,0.04);border-radius:8px;position:relative;cursor:pointer}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),#06b6d4);width:0%;border-radius:8px}

    .bottom-row{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .left-tools{display:flex;gap:10px;align-items:center}
    .right-tools{display:flex;gap:10px;align-items:center}

    .playlist{background:var(--card);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:10px;height:640px;overflow:auto}
    .playlist h3{margin:0;font-size:16px}
    .list{display:flex;flex-direction:column;gap:8px}
    .track{display:flex;align-items:center;gap:12px;padding:8px;border-radius:10px;cursor:pointer}
    .track:hover{background:rgba(255,255,255,0.01)}
    .track .idx{width:28px;text-align:center;color:var(--muted)}
    .track .meta{flex:1}
    .track .meta .t{font-weight:600}
    .track .meta .s{color:var(--muted);font-size:13px}

    .uploader{display:flex;gap:8px;align-items:center}
    input[type=file]{display:none}
    .badge{font-size:12px;padding:6px 10px;background:rgba(255,255,255,0.02);border-radius:999px;border:1px solid rgba(255,255,255,0.03)}

    canvas.visual{width:100%;height:120px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));}

    .small{font-size:12px;color:var(--muted)}

    footer.note{text-align:center;color:var(--muted);margin-top:10px;font-size:13px}

    @media (max-width:980px){.app{grid-template-columns:1fr; padding:12px} .playlist{height:340px}}
  </style>
</head>
<body>
  <div class="app">
    <section class="player">
      <div class="meta">
        <div class="cover" id="cover">üéµ</div>
        <div class="track-info">
          <div class="title" id="title">Nothing Playing</div>
          <div class="artist" id="artist">‚Äî</div>
          <div class="small" style="margin-top:8px">Try uploading local tracks or use demo files in the playlist.</div>
        </div>
      </div>

      <canvas class="visual" id="visual"></canvas>

      <div class="progress">
        <div class="time" id="cur">0:00</div>
        <div class="progress-bar" id="bar"><div class="progress-fill" id="fill"></div></div>
        <div class="time" id="dur">0:00</div>
      </div>

      <div class="controls">
        <div class="left-tools">
          <button class="btn" id="shuffle" title="Shuffle">üîÄ</button>
        </div>

        <div style="flex:1;display:flex;justify-content:center">
          <div class="controls" style="gap:10px">
            <button class="btn" id="prev" title="Previous">‚èÆÔ∏è</button>
            <button class="btn big" id="play" title="Play/Pause">‚ñ∂Ô∏è</button>
            <button class="btn" id="next" title="Next">‚è≠Ô∏è</button>
          </div>
        </div>

        <div class="right-tools">
          <button class="btn" id="repeat" title="Repeat">üîÅ</button>
          <div class="badge" id="volwrap">Vol <input id="vol" type="range" min="0" max="1" step="0.01" value="1"></div>
        </div>
      </div>

      <div class="bottom-row">
        <div class="uploader">
          <label class="btn" for="files">üìÅ Add Files</label>
          <input id="files" multiple accept="audio/*" type="file">
          <button class="btn" id="clear">üóëÔ∏è Clear</button>
        </div>
        <div class="small">Keyboard: Space = Play/Pause ‚Ä¢ ‚Üê/‚Üí = Prev/Next</div>
      </div>

      <footer class="note">Music Player Simulation ‚Äî works offline with your local files</footer>
    </section>

    <aside class="playlist">
      <h3>Playlist</h3>
      <div class="list" id="playlist"></div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div class="small">Demo tracks included for convenience</div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="addDemo">‚ûï Add Demos</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // Simple music player with visualizer and playlist
    const audio = new Audio();
    audio.crossOrigin = 'anonymous';

    const ctxAudio = new (window.AudioContext || window.webkitAudioContext)();
    const source = ctxAudio.createMediaElementSource(audio);
    const analyser = ctxAudio.createAnalyser();
    analyser.fftSize = 256;
    source.connect(analyser);
    analyser.connect(ctxAudio.destination);

    const playlistEl = document.getElementById('playlist');
    const fill = document.getElementById('fill');
    const bar = document.getElementById('bar');
    const cur = document.getElementById('cur');
    const dur = document.getElementById('dur');
    const playBtn = document.getElementById('play');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const title = document.getElementById('title');
    const artist = document.getElementById('artist');
    const cover = document.getElementById('cover');
    const files = document.getElementById('files');
    const addDemo = document.getElementById('addDemo');
    const vol = document.getElementById('vol');
    const shuffleBtn = document.getElementById('shuffle');
    const repeatBtn = document.getElementById('repeat');
    const clearBtn = document.getElementById('clear');

    let tracks = [];
    let current = -1;
    let isPlaying = false;
    let isShuffle = false;
    let isRepeat = false;

    function secondsToTime(s){
      if (!isFinite(s)) return '0:00';
      s = Math.floor(s);
      const m = Math.floor(s/60);
      const sec = String(s%60).padStart(2,'0');
      return `${m}:${sec}`;
    }

    function renderPlaylist(){
      playlistEl.innerHTML = '';
      tracks.forEach((t,i)=>{
        const el = document.createElement('div');
        el.className = 'track';
        el.innerHTML = `<div class="idx">${i+1}</div><div class="meta"><div class="t">${escapeHtml(t.title || t.name)}</div><div class="s">${escapeHtml(t.artist || '')}</div></div><div class="dur small">${t.displayDuration || ''}</div>`;
        el.addEventListener('click', ()=>playIndex(i));
        playlistEl.appendChild(el);
      });
    }

    function escapeHtml(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

    function addTrackFromFile(file){
      const url = URL.createObjectURL(file);
      const track = {src:url, name:file.name, title:file.name.replace(/\.[^/.]+$/,'')};
      tracks.push(track);
      // load duration asynchronously
      const tmp = new Audio(); tmp.src = url; tmp.addEventListener('loadedmetadata', ()=>{ track.displayDuration = secondsToTime(tmp.duration); renderPlaylist(); });
      renderPlaylist();
    }

    files.addEventListener('change', (e)=>{
      const list = Array.from(e.target.files||[]);
      list.forEach(addTrackFromFile);
      files.value = '';
    });

    clearBtn.addEventListener('click', ()=>{
      tracks = []; current = -1; audio.pause(); audio.src = ''; isPlaying=false; updateUI(); renderPlaylist();
    });

    addDemo.addEventListener('click', ()=>{
      // demo public-domain sample mp3s
      const demos = [
        {src:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', title:'SoundHelix Song 1', artist:'Demo'},
        {src:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3', title:'SoundHelix Song 2', artist:'Demo'},
      ];
      demos.forEach(d=>tracks.push(Object.assign({},d)));
      renderPlaylist();
    });

    function playIndex(i){
      if (i<0 || i>=tracks.length) return;
      current = i;
      audio.src = tracks[i].src;
      audio.play();
      isPlaying = true;
      updateUI();
      ensureAudioContextRunning();
    }

    function ensureAudioContextRunning(){ if (ctxAudio.state === 'suspended') ctxAudio.resume(); }

    playBtn.addEventListener('click', ()=>{
      if (!audio.src && tracks.length>0) return playIndex(0);
      if (audio.paused){ audio.play(); isPlaying=true; ensureAudioContextRunning(); }
      else { audio.pause(); isPlaying=false; }
      updateUI();
    });

    prevBtn.addEventListener('click', ()=>{
      if (tracks.length===0) return;
      if (audio.currentTime>3) { audio.currentTime=0; return; }
      if (isShuffle) playIndex(Math.floor(Math.random()*tracks.length));
      else playIndex((current-1+tracks.length)%tracks.length);
    });

    nextBtn.addEventListener('click', ()=>{
      if (tracks.length===0) return;
      if (isShuffle) playIndex(Math.floor(Math.random()*tracks.length));
      else playIndex((current+1)%tracks.length);
    });

    shuffleBtn.addEventListener('click', ()=>{ isShuffle=!isShuffle; shuffleBtn.style.opacity = isShuffle?1:0.6; });
    repeatBtn.addEventListener('click', ()=>{ isRepeat=!isRepeat; repeatBtn.style.opacity = isRepeat?1:0.6; audio.loop = isRepeat; });

    audio.addEventListener('timeupdate', ()=>{
      const p = (audio.currentTime / (audio.duration||1))*100;
      fill.style.width = p + '%';
      cur.textContent = secondsToTime(audio.currentTime);
      dur.textContent = secondsToTime(audio.duration);
    });

    audio.addEventListener('ended', ()=>{
      if (isRepeat) { audio.currentTime=0; audio.play(); return; }
      if (isShuffle) playIndex(Math.floor(Math.random()*tracks.length));
      else nextBtn.click();
    });

    bar.addEventListener('click', (e)=>{
      const r = bar.getBoundingClientRect();
      const x = e.clientX - r.left; const p = x / r.width; if (audio.duration) audio.currentTime = p * audio.duration;
    });

    vol.addEventListener('input', ()=>{ audio.volume = vol.value; });

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (e.code === 'Space'){ e.preventDefault(); playBtn.click(); }
      if (e.code === 'ArrowRight'){ nextBtn.click(); }
      if (e.code === 'ArrowLeft'){ prevBtn.click(); }
    });

    // handle play / pause UI and metadata
    audio.addEventListener('play', ()=>{ isPlaying=true; updateUI(); });
    audio.addEventListener('pause', ()=>{ isPlaying=false; updateUI(); });
    audio.addEventListener('loadedmetadata', ()=>{ if (current>=0) tracks[current].displayDuration = secondsToTime(audio.duration); renderPlaylist(); });

    function updateUI(){
      playBtn.textContent = isPlaying? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
      if (current>=0){ const t = tracks[current]; title.textContent = t.title || t.name || 'Unknown'; artist.textContent = t.artist || t.album || '';
        cover.textContent = (t.title||'').slice(0,2).toUpperCase();
      } else { title.textContent = 'Nothing Playing'; artist.textContent='‚Äî'; cover.textContent='üéµ'; }
    }

    // visualizer drawing
    const canvas = document.getElementById('visual');
    const c = canvas.getContext('2d');
    function resizeCanvas(){ canvas.width = canvas.clientWidth * devicePixelRatio; canvas.height = canvas.clientHeight * devicePixelRatio; c.scale(devicePixelRatio, devicePixelRatio); }
    window.addEventListener('resize', ()=>{ resizeCanvas(); });
    resizeCanvas();

    function draw(){
      requestAnimationFrame(draw);
      const w = canvas.clientWidth; const h = canvas.clientHeight;
      c.clearRect(0,0,w,h);
      const buffer = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteFrequencyData(buffer);
      const barWidth = Math.max(2, w / buffer.length);
      for (let i=0;i<buffer.length;i++){
        const v = buffer[i]/255; const x = i*barWidth; const barH = v*h*0.9;
        const grad = c.createLinearGradient(0,0,0,h);
        grad.addColorStop(0,'rgba(124,58,237,0.9)');
        grad.addColorStop(1,'rgba(6,182,212,0.6)');
        c.fillStyle = grad;
        c.fillRect(x, h-barH, barWidth*0.9, barH);
      }
    }
    draw();

    // small helper: if user interacts with page, resume audio context
    document.addEventListener('click', ()=>{ if (ctxAudio.state === 'suspended') ctxAudio.resume(); }, {once:false});

    // initial demo: empty playlist with instructions
    renderPlaylist();
    updateUI();
  </script>
</body>
</html>
